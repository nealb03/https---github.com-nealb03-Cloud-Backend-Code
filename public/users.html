<!DOCTYPE html>
<html>
<head>
  <title>Users</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 15px; }
    th, td { border: 1px solid #999; padding: 8px 12px; text-align: left; }
    th { background-color: #f2f2f2; }
    tbody tr:nth-child(even) { background-color: #f9f9f9; }
    #pagination { margin-top: 20px; }
    #pagination button { padding: 5px 10px; margin-right: 5px; }
  </style>
</head>
<body>
  <h1>Users</h1>
  <table id="users-table">
    <thead></thead>
    <tbody></tbody>
  </table>
  <div id="pagination">
    <button id="prev-btn" disabled>Prev</button>
    <span id="page-info"></span>
    <button id="next-btn" disabled>Next</button>
  </div>

  <script>
    let currentPage = 1;
    const limit = 10;

    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const pageInfo = document.getElementById('page-info');
    const thead = document.querySelector('#users-table thead');
    const tbody = document.querySelector('#users-table tbody');

    async function fetchUsers(page = 1) {
      const res = await fetch(`/api/users?page=${page}&limit=${limit}`);
      if (!res.ok) {
        tbody.innerHTML = '<tr><td colspan="100%">Error loading users</td></tr>';
        return;
      }

      const { data, totalPages } = await res.json();

      if (data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="100%">No users found</td></tr>';
        thead.innerHTML = '';
        pageInfo.textContent = '';
        prevBtn.disabled = true;
        nextBtn.disabled = true;
        return;
      }

      // Build header
      const headers = Object.keys(data[0]);
      thead.innerHTML = '<tr>' + headers.map(h => `<th>${h.replace(/_/g, ' ').toUpperCase()}</th>`).join('') + '</tr>';

      // Build body rows
      tbody.innerHTML = data.map(user => {
        return '<tr>' + headers.map(h => `<td>${user[h] ?? ''}</td>`).join('') + '</tr>';
      }).join('');

      // Update pagination buttons and info
      pageInfo.textContent = `Page ${page} of ${totalPages}`;
      prevBtn.disabled = page <= 1;
      nextBtn.disabled = page >= totalPages;

      currentPage = page;
    }

    prevBtn.addEventListener('click', () => {
      if (currentPage > 1) fetchUsers(currentPage - 1);
    });

    nextBtn.addEventListener('click', () => {
      fetchUsers(currentPage + 1);
    });

    // Initial load
    fetchUsers(currentPage);
  </script>
</body>
</html>